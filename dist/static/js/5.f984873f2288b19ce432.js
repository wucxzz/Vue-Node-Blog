webpackJsonp([5],{199:function(e,t,n){function r(e){n(298)}var o=n(26)(n(254),n(322),r,"data-v-fb19e39e",null);e.exports=o.exports},228:function(e,t,n){e.exports={default:n(234),__esModule:!0}},234:function(e,t,n){var r=n(9),o=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}},252:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(228),o=n.n(r);t.default={name:"CommentForm",props:["replyUserId","replyUserName","commentID"],data:function(){return{label:"留言",login:!1,dialogVisible:!1,oriName:"",oriWebsite:"",oriReminder:!1,remember:!1,ruleForm:{name:"",email:"",website:"",avatar:"",reminder:!1,content:""},rules:{name:[{required:!0,message:"请输入大名",trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"}],email:[{required:!0,type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],content:[{required:!0,message:"亲输入你的见解",trigger:"blur"}]}}},methods:{submitHandle:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return t.$message({showClose:!0,message:"数据有误，提交失败",type:"error"}),!1;t.$http.get("/api/visitor/getVisitor",{params:{email:t.ruleForm.email}}).then(function(e){e=e.data;var n={aid:t.$route.params.id,uname:t.ruleForm.name.trim(),website:t.ruleForm.website.trim(),avatar:t.ruleForm.avatar,rid:t.replyUserId,rname:t.replyUserName,rCommentID:t.replyUserId?t.commentID:null,email:t.ruleForm.email,content:t.ruleForm.content,reminder:t.ruleForm.email&&t.ruleForm.reminder?1:0,time:(new Date).getTime()};if(e){if(e.reminder=1===e.reminder,e.name!==t.ruleForm.name.trim()||e.reminder!==t.ruleForm.reminder||e.website&&t.ruleForm.website!==e.website)return t.oriName=e.name,t.oriWebsite=e.website||"",t.oriReminder=e.reminder,void(t.dialogVisible=!0);n.uid=e.id,n.avatar=e.avatar}t.$http.post("/api/comment/writeComment",n).then(function(e){if(t.$message.success("提交成功"),t.replyUserId?t.formHanle({show:!1,data:e.data}):t.formHanle({show:!0,data:e.data}),t.remember){var n={email:t.ruleForm.email,name:t.ruleForm.name.trim(),website:t.ruleForm.website.trim(),reminder:t.ruleForm.reminder,remember:t.remember};localStorage.visitorMes=o()(n)}else delete localStorage.visitorMes;t.ruleForm.content=""}).catch(function(e){throw e})}).catch(function(e){throw e})})},cancleHandle:function(e){this.$refs[e].resetFields(),this.ruleForm.reminder=!1,this.formHanle({show:!1})},formHanle:function(e){this.$emit("formHanle",e)},updVisitorMes:function(){var e=this;this.login||this.$http.post("/api/visitor/updVisitorMes",{email:this.ruleForm.email,name:this.ruleForm.name.trim(),website:this.ruleForm.website.trim(),reminder:this.ruleForm.email&&this.ruleForm.reminder?1:0}).then(function(t){t.data?(e.$message.success("更新成功,请再次提交"),e.dialogVisible=!1):e.$message.error("更新失败,请更换eamil"),e.dialogVisible=!1}).catch(function(e){throw e})},useVisitorMes:function(){this.ruleForm.name=this.oriName,this.ruleForm.website=this.oriWebsite,this.ruleForm.reminder=this.oriReminder,this.dialogVisible=!1}},computed:{labelString:function(){return this.label+(this.replyUserName?" @"+this.replyUserName:"")}},created:function(){var e=this,t=localStorage.visitorMes&&JSON.parse(localStorage.visitorMes);t&&(this.ruleForm.name=t.name,this.ruleForm.email=t.email,this.ruleForm.website=t.website,this.ruleForm.reminder=t.reminder,this.remember=t.remember),this.$http.get("/api/getSession").then(function(t){(t=t.data)&&1===t.root&&(e.ruleForm.name=t.name,e.ruleForm.email=t.email,e.ruleForm.website=t.website||"",e.ruleForm.avatar=t.avatar,e.login=!0)}).catch(function(e){throw e})}}},254:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(81),o=n.n(r),i=n(317),a=n.n(i);t.default={name:"comment",components:{commentForm:a.a},data:function(){return{avatarRoot:"../../../static/images/avatar/",replyUserId:"",replyUserName:"",commentFormShow:!0,isHighLight:!1,comments:[],commentLen:0}},created:function(){var e=this,t=this.$route.params.id;this.$http.get("/api/comment/getComment",{params:{articleID:t}}).then(function(t){e.comments=t.data,e.commentLen=t.data.length;for(var n=0;n<e.commentLen;n++)e.comments[n].replyFormShow=!1}).catch(function(e){throw e})},methods:{replyHandle:function(e,t,n,r){for(var i=0;i<this.commentLen;i++){var a=this.comments[i].commentID;this.comments[i]=o()({},this.comments[i],{replyFormShow:a==e}),a==e&&(this.replyUserId=t,this.replyUserName=n)}this.commentFormShow=!1},formShowState:function(e){var t=e.show,n=e.data;if(!t){for(var r=0;r<this.commentLen;r++)this.comments[r]=o()({},this.comments[r],{replyFormShow:!1});this.commentFormShow=!0}if(n)if(n.rid){for(var i=0;i<this.commentLen;i++)if(this.comments[i].commentID===n.rCommentID){!this.comments[i].replys&&(this.comments[i].replys=[]),this.comments[i].replys.push(n);break}}else this.comments.push(n),this.commentLen+=1},timeFormat:function(e){var t=(new Date).getTime(),n=t-e;return n<6e4?"刚刚":n>6e4&&n<36e5?Math.floor(n/6e4)+"分钟前":n>36e5&&n<864e5?"今天 "+new Date(e).format("hh:mm"):new Date(e).format("M月d日 hh:mm")}}}},288:function(e,t,n){t=e.exports=n(195)(!0),t.push([e.i,".from-comment{width:300px}.comment-text{width:600px}@media only screen and (max-width:768px){.comment-text,.from-comment{width:100%}}","",{version:3,sources:["D:/jsoft/Full Stack/新建文件夹/My-Blog/Vue-Node-Blog/backups/src/components/common/CommentForm.vue"],names:[],mappings:"AACA,cACI,WAAa,CAChB,AACD,cACI,WAAa,CAChB,AACD,yCACA,4BACQ,UAAY,CACnB,CACA",file:"CommentForm.vue",sourcesContent:["\n.from-comment {\n    width: 300px;\n}\n.comment-text {\n    width: 600px;\n}\n@media only screen and (max-width: 768px) {\n.from-comment, .comment-text {\n        width: 100%;\n}\n}\n"],sourceRoot:""}])},290:function(e,t,n){t=e.exports=n(195)(!0),t.push([e.i,'.clearfix[data-v-fb19e39e]:after{content:"";display:block;clear:both}.article-comment[data-v-fb19e39e]{margin-top:10px;padding:20px;background:#fff}.comment-detail[data-v-fb19e39e]{border-top:1px solid #ccc;margin-top:60px;padding-top:20px}.comment-count[data-v-fb19e39e]{margin-bottom:20px}.comment-list[data-v-fb19e39e]{border:1px solid #0db1ff;padding:10px;margin-bottom:20px}.comment-psn img[data-v-fb19e39e]{width:35px;height:35px;border-radius:50%;float:left}.comment-psn .psn-mes[data-v-fb19e39e]{height:35px;line-height:20px;margin-left:45px}.comment-psn .psn-mes p[data-v-fb19e39e]{padding:0;margin:0}.comment-btn[data-v-fb19e39e],.comment-psn .psn-mes .reply-time[data-v-fb19e39e]{font-size:.5em}.comment-btn span[data-v-fb19e39e]{margin-right:10px;cursor:pointer}.reply[data-v-fb19e39e]{background:#eaeaec;padding:10px;margin-top:5px}.reply>div[data-v-fb19e39e]:not(:last-child){border-bottom:1px solid #d9d9d9}.reply p[data-v-fb19e39e]{margin:0;font-size:.5em;padding:3px 0}.reply .reply-psn[data-v-fb19e39e]{color:#307d74;cursor:pointer}.comment-list span.highlight[data-v-fb19e39e],p.highlight[data-v-fb19e39e]{color:red;font-weight:700}',"",{version:3,sources:["D:/jsoft/Full Stack/新建文件夹/My-Blog/Vue-Node-Blog/backups/src/components/page/Comment.vue"],names:[],mappings:"AACA,iCACI,WAAY,AACZ,cAAe,AACf,UAAY,CACf,AACD,kCACI,gBAAiB,AACjB,aAAc,AACd,eAAiB,CACpB,AACD,iCACI,0BAA2B,AAC3B,gBAAiB,AACjB,gBAAiB,CACpB,AACD,gCACI,kBAAoB,CACvB,AACD,+BACI,yBAA0B,AAC1B,aAAc,AACd,kBAAoB,CACvB,AACD,kCACI,WAAY,AACZ,YAAa,AACb,kBAAmB,AACnB,UAAY,CACf,AACD,uCACI,YAAa,AACb,iBAAkB,AAClB,gBAAkB,CACrB,AACD,yCACI,UAAW,AACX,QAAU,CACb,AACD,iFACI,cAAe,CAClB,AACD,mCACI,kBAAmB,AACnB,cAAgB,CACnB,AACD,wBACI,mBAAoB,AACpB,aAAc,AACd,cAAgB,CACnB,AACD,6CACI,+BAAiC,CACpC,AACD,0BACI,SAAU,AACV,eAAgB,AAChB,aAAe,CAClB,AACD,mCACI,cAAe,AACf,cAAgB,CACnB,AACD,2EACI,UAAW,AACX,eAAkB,CACrB",file:"Comment.vue",sourcesContent:["\n.clearfix[data-v-fb19e39e]::after {\n    content: '';\n    display: block;\n    clear: both;\n}\n.article-comment[data-v-fb19e39e]{\n    margin-top: 10px;\n    padding: 20px;\n    background: #fff;\n}\n.comment-detail[data-v-fb19e39e] {\n    border-top: 1px solid #ccc;\n    margin-top: 60px; \n    padding-top: 20px\n}\n.comment-count[data-v-fb19e39e] {\n    margin-bottom: 20px;\n}\n.comment-list[data-v-fb19e39e] {\n    border: 1px solid #0db1ff;\n    padding: 10px;\n    margin-bottom: 20px;\n}\n.comment-psn img[data-v-fb19e39e] {\n    width: 35px;\n    height: 35px;\n    border-radius: 50%;\n    float: left;\n}\n.comment-psn .psn-mes[data-v-fb19e39e] {\n    height: 35px;\n    line-height: 20px;\n    margin-left: 45px;\n}\n.comment-psn .psn-mes p[data-v-fb19e39e] {\n    padding: 0;\n    margin: 0;\n}\n.comment-psn .psn-mes .reply-time[data-v-fb19e39e], .comment-btn[data-v-fb19e39e] {\n    font-size: .5em\n}\n.comment-btn span[data-v-fb19e39e] {\n    margin-right: 10px;\n    cursor: pointer;\n}\n.reply[data-v-fb19e39e] {\n    background: #eaeaec;\n    padding: 10px;\n    margin-top: 5px;\n}\n.reply>div[data-v-fb19e39e]:not(:last-child) {\n    border-bottom: 1px solid #d9d9d9;\n}\n.reply p[data-v-fb19e39e] {\n    margin: 0;\n    font-size: .5em;\n    padding: 3px 0;\n}\n.reply .reply-psn[data-v-fb19e39e] {\n    color: #307d74;\n    cursor: pointer;\n}\n.comment-list span.highlight[data-v-fb19e39e], p.highlight[data-v-fb19e39e] {\n    color: red;\n    font-weight: bold;\n}\n"],sourceRoot:""}])},296:function(e,t,n){var r=n(288);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);n(196)("2088dd1b",r,!0,{})},298:function(e,t,n){var r=n(290);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);n(196)("0da5874e",r,!0,{})},317:function(e,t,n){function r(e){n(296)}var o=n(26)(n(252),n(320),r,null,null);e.exports=o.exports},320:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-form",{ref:"commentForm",staticClass:"from-comment",attrs:{model:e.ruleForm,rules:e.rules,"label-position":"top"}},[n("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[n("el-input",{attrs:{disabled:e.login},model:{value:e.ruleForm.email,callback:function(t){e.$set(e.ruleForm,"email",t)},expression:"ruleForm.email"}}),e._v(" "),e.login?e._e():n("el-checkbox",{model:{value:e.ruleForm.reminder,callback:function(t){e.$set(e.ruleForm,"reminder",t)},expression:"ruleForm.reminder"}},[e._v("收到回复邮件提醒")])],1),e._v(" "),n("el-form-item",{attrs:{label:"大名",prop:"name"}},[n("el-input",{attrs:{disabled:e.login},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"个人网站",prop:"website"}},[n("el-input",{attrs:{disabled:e.login},model:{value:e.ruleForm.website,callback:function(t){e.$set(e.ruleForm,"website",t)},expression:"ruleForm.website"}})],1),e._v(" "),n("el-form-item",{staticClass:"comment-text",attrs:{label:e.labelString,prop:"content"}},[n("el-input",{attrs:{type:"textarea",spellcheck:"false",rows:5},model:{value:e.ruleForm.content,callback:function(t){e.$set(e.ruleForm,"content",t)},expression:"ruleForm.content"}})],1)],1),e._v(" "),e.login?e._e():n("el-checkbox",{staticStyle:{display:"block","margin-bottom":"5px",width:"0"},model:{value:e.remember,callback:function(t){e.remember=t},expression:"remember"}},[e._v("记住我？")]),e._v(" "),n("el-button",{attrs:{type:"success"},on:{click:function(t){e.submitHandle("commentForm")}}},[e._v("提交")]),e._v(" "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:e.replyUserName,expression:"replyUserName"}],attrs:{type:"danger"},on:{click:function(t){e.cancleHandle("commentForm")}}},[e._v("取消")]),e._v(" "),n("el-dialog",{attrs:{title:"提示：email用户已存在如下信息",visible:e.dialogVisible,size:"tiny"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("span",[n("p",[n("strong",[e._v("大名：")]),e._v(e._s(e.oriName))]),e._v(" "),n("p",[n("strong",[e._v("个人网站：")]),e._v(e._s(e.oriWebsite))]),e._v(" "),n("p",[n("el-checkbox",{attrs:{disabled:!0},model:{value:e.oriReminder,callback:function(t){e.oriReminder=t},expression:"oriReminder"}},[e._v("收到回复邮件提醒")])],1)]),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"success"},on:{click:e.updVisitorMes}},[e._v("更新信息")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.useVisitorMes}},[e._v("使用已存在信息")])],1)])],1)},staticRenderFns:[]}},322:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"article-comment",attrs:{id:"liuyan"}},[e.commentFormShow?n("commentForm",{on:{formHanle:e.formShowState}}):e._e(),e._v(" "),n("div",{staticClass:"comment-detail"},[n("div",{staticClass:"comment-count"},[e._v("评论：（共 "+e._s(e.commentLen)+" 条）")]),e._v(" "),e._l(e.comments,function(t){return n("div",{key:t.commentID,staticClass:"comment-list clearfix"},[n("div",{staticClass:"comment-psn"},[n("img",{attrs:{src:e.avatarRoot+(t.avatar||"visitor_avatar.jpg"),alt:""}}),e._v(" "),n("div",{staticClass:"psn-mes"},[n("p",{class:{highlight:e.isHighLight}},[n("strong",[e._v(e._s(t.uname))])]),e._v(" "),n("p",{staticClass:"reply-time"},[e._v(e._s(e.timeFormat(t.time)))])])]),e._v(" "),n("p",[e._v(e._s(t.content))]),e._v(" "),n("div",{staticClass:"comment-btn"},[n("span",[e._v("支持")]),e._v(" "),n("span",{on:{click:function(n){e.replyHandle(t.commentID,t.uid,t.uname)}}},[e._v("回复")])]),e._v(" "),t.replys?n("div",{staticClass:"reply"},e._l(t.replys,function(r,o){return n("div",{key:o},[n("p",[n("span",{staticClass:"reply-psn",class:{highlight:e.isHighLight},on:{click:function(n){e.replyHandle(t.commentID,r.uid,r.uname,n)}}},[e._v(e._s(r.uname)+" ")]),e._v(" "),r.rname?n("span",[e._v("回复\n                            "),n("span",{staticClass:"reply-psn",class:{highlight:e.isHighLight},on:{click:function(n){e.replyHandle(t.commentID,r.rid,r.rname,n)}}},[e._v(e._s(r.rname))])]):e._e(),e._v(": \n                        "+e._s(r.content)+"\n                    ")]),e._v(" "),n("p",[e._v(e._s(e.timeFormat(r.time)))])])})):e._e(),e._v(" "),t.replyFormShow?n("commentForm",{staticStyle:{padding:"10px",margin:"10px 0",border:"1px dotted #ccc",background:"#fff"},attrs:{replyUserId:e.replyUserId,replyUserName:e.replyUserName,commentID:t.commentID},on:{formHanle:e.formShowState}}):e._e()],1)})],2)],1)},staticRenderFns:[]}}});
//# sourceMappingURL=5.f984873f2288b19ce432.js.map